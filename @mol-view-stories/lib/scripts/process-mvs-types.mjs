import fs from 'node:fs';

let data = fs.readFileSync('./tmp/mvs.d.ts', 'utf-8');
data = data
  .replaceAll('`', '\\`')
  .replaceAll('${', '\\${')
  .replaceAll(/(\r\n|\n|\r)/g, '\n');

const lib = ['Vec3', 'Mat3', 'Mat4', 'Quat', 'Euler'];

const lines = data.split('\n'); // .filter(line => !line.startsWith('export '));
const final = [
  '// Automatically generated file. Do not edit manually.',
  '// This file is generated by deno task mvs-types',
  '',
  '/**',
  ' * TypeScript type definitions for the Mol* Viewer (MVS) API.',
  ' * ',
  ' * This string contains complete type definitions that can be used with Monaco Editor',
  ' * to provide IntelliSense/autocomplete for MVS scene JavaScript code.',
  ' * ',
  ' * @example',
  ' * ```typescript',
  ' * import { setupMonacoCodeCompletion, MVSTypes } from "@mol-view-stories/lib";',
  ' * ',
  ' * // Configure Monaco Editor for MVS code completion',
  ' * setupMonacoCodeCompletion(monaco, MVSTypes);',
  ' * ```',
  ' */',
  'export const MVSTypes = `',
  'namespace _ {',
  ...lines.map((line) => `    ${line}`),
  '}',
  '',
  'declare const builder: _.Builder;',
  ...lib.map((name) => `declare const ${name}: typeof _.${name};`),
  `declare function decodeColor(input: string): number;`,
  '`;',
];

fs.writeFileSync('./src/mvs-types.ts', final.join('\n'), 'utf-8');
